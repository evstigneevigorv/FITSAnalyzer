# FITSAnalyzer

## Описание

  Программа для просмотра файлов формата FITS (Flexible Image Transport System) и
рсчета графика изменения мощности излучения по нескольким снимкам.

## Руководство пользователя

  После запуска программы (FitsAnalyzer.exe) выберите один или несколько файлов
для просмотра с помощью меню "Файл->Открыть" или соответствующей кпонкой на панели
инструментов. В появившемся диалоговом окне можно выбирать один или сразу
несколько файлов.
  Программа может отображать таблицу свойств из заголовков FITS-файлов и
снимки, если таковые содержатся в файле.
  Если в файле содержатся только заголовки свойств, отображается только таблица
с их значениями.
  Если в файле есть фотоснимки (2D-изображения), они отображаются
в основном поле главного окна программы. Управлять масштабом отображения можно
с помощью пунктов главного меню "Вид": "Приблизить", "Отдалить" и "Масштаб 100%",
соответствующими кпонками на панели интсрументов или горячими клавишами (описаны
в пунктах главного меню).
  Если были выбраны одновременно несколько файлов для открытия, становятся
активными дополнительные пункты меню и кнопки панели инструментов. Можно
перемещаться между данными файлов, используя пункты меню "Вид": "Предыдущий снимок"
и "Следующий снимок", или выбрав номер желаемого снимка в выпадающем списке
на панели инструментов.
  Также, если открыто несколько файлов со снимками, становится доступным пункт
меню "Действия->Расчет зависимости", позволяющий рассчитать график изменения
мощности свечения в заданном диапазоне амплитуд со временем.
   
## Руководство программиста

  FITS-файлы могут содержать сжатые данные. Сжатие может проводиться несколькими
разными алгоритмами. Для того, чтобы работать с уже распакованными файлами,
программа при открытие любого файла(ов) создает рабочую директорию fits в той же
директории, откуда запускается исполняемый файл. Программа копирует каждый
открываемый файл в эту папку (создает его рабочую копию) и распаковывает файл
с помощью внешней утилиты Funpack.exe, производя ее вызов из командной строки
с необходимыми аргументами. Программа Funpack.exe использует библиотеку cfitsio.
Поэтому файлы Funpack.exe и cfitsio.dll должны находиться в той же директории,
где находится испольняемый файл программы FitsAnalyzer (для этого они включены ).
  Ссылки на внешние ресурсы:
  [Fpack & Funpack](https://heasarc.gsfc.nasa.gov/docs/software/fitsio/fpack/)
  [cfitsio](https://heasarc.gsfc.nasa.gov/docs/software/fitsio/fitsio.html)
  Распакованная версия рабочей копии файла в дальнейшем обрабатывается библиотекой
CSharpFITS. Рабочая директория fits со всеми рабочими копиями удаляется при закрытии
окна.

  **Важно**
  
  Библиотека CSharpFITS использует внутри для получения значений свойств(карт)
функции double.Parse(), которые зависят от выбранного в системе представления
дробных чисел. И если в системе выбран разделитель для дробной части ',' (запятая)
эти функции перестают парсить реальные значения и возвращают значнения по умолчанию.
Поэтому в конструкторе главного окна MainForm() искусственно устанавливается
инвариантная форма записи:
  ```C#
  Thread.CurrentThread.CurrentCulture = System.Globalization.CultureInfo.InvariantCulture;
  ```
  
  Чтобы не менять свойство Enabled каждого контрола в отдельности, при разных
вариантах: один файл или много, в конструкторе главного окна сформированы два
списка элементов управления:
- **singleSwitchableControls** - это элементы, которые становятся активными
при открытии хоть одного, хоть нескольких файлов;
- **multipleSwitchableControls** - это элементы, которые становятся активными
только при открытии сразу нескольких файлов.

  **Важно**
  
  Библиотека CSharpFITS содержит в себе определения новых классов, названия
которых совпадает с уже имеющимися в .NET Framework типами/эдементами управления,
например, Cursor. Поэтому в программе использование библиотеки вынесено в отдельный
класс FitsWrapper (файл Fits.cs).

  